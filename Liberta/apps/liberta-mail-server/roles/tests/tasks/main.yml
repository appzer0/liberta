---
- name: Check that all required TCP ports are responding
  wait_for:
    host: localhost
    port: ""{{ item }}""
    state: started         # Port should be open
    delay: 0               # No wait before first check (sec)
    timeout: 3             # Stop checking after timeout (sec)
  ignore_errors: yes
  with_items:
    - 443
    - 80
    - 25
    - 587

- name: Try sending an email to Postfix over Submission port
  mail:
    host: localhost
    username: "{{ admin_mailbox_username }}"
    password: "{{ admin_mailbox_password }}"
    port: 587
    to: Libertadmin <libertadmin@liberta.vip>
    subject: Ansible Mail Test Submission
    body: Test email over Submission port.
